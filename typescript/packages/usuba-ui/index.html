<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Usuba</title>
  <link rel="stylesheet" href="/shoelace/dist/themes/light.css" />
  <link rel="stylesheet" href="/shoelace/dist/themes/dark.css" />
  <link rel="stylesheet" href="/usuba-ui/styles.css" />
</head>

<body>
  <section id="specifier">
    <sl-select aria-label="Language" label="Language" value="js">
      <sl-option aria-selected="true" value="js">JavaScript</sl-option>
      <sl-option disabled value="py">Python</sl-option>
      <sl-option disabled value="rs">Rust</sl-option>
    </sl-select>
    <sl-input aria-readonly="true" readonly label="Module specifier"></sl-input>
    <sl-copy-button label="Copy to smizmar"></sl-copy-button>
  </section>
  <section id="code">
    <sl-textarea label="WIT" resize="none" rows="16" spellcheck="false">
    </sl-textarea>
    <sl-textarea label="Source Code" resize="none" rows="16" spellcheck="false">
    </sl-textarea>
  </section>

  <sl-button>special btn</sl-button>

  <script type="module">
    if ("serviceWorker" in navigator) {
      try {
        const registration = await navigator.serviceWorker.register("/usuba-sw.js", {
          type: "module",
          scope: "/"
        });
        if (registration.installing) {
          console.log("Service worker installing");
        } else if (registration.waiting) {
          console.log("Service worker installed");
        } else if (registration.active) {
          console.log("Service worker active");
        }

        const clientOrigin = new URL(window.location.toString()).searchParams.get('client');

        if (clientOrigin != null && self.parent != null) {
          const targetOrigin = new URL(clientOrigin).origin.toString();
          console.log(`Service worker activated; sending signal to ${targetOrigin}`);
          self.parent.postMessage('activated', targetOrigin);
        }
      } catch (error) {
        console.error(`Registration failed with ${error}`);
      }
    }
  </script>

  <script type="module" src="./src/index.ts"></script>
</body>

</html>